<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700;800&family=Source+Sans+Pro:wght@400;600;700;800&family=DM+Sans:wght@100..1000&family=Plus+Jakarta+Sans:wght@600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/css/style.min.css" />
    <link rel="stylesheet" href="./styles.css">
    <style type="text/css">
        body{background:#f3f2ff;}

        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #000;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>


</head>
<script src="//etra.group/common/ckeditor/ckeditor.js"></script>

<body>
    {message}


    <form method="POST" id="saveFormData" enctype="multipart/form-data">
        <input type="hidden" name="id" value="{id}">
        <input type="hidden" name="country" value="us">        
        <div class="basic-container" style="max-width: 1140px;margin: auto;margin-top: 60px;background: white;padding: 40px 30px 150px;">
            <div class="form-group">
                <label>Publish Date</label>
                <input type="date" id="publish-date" name="date" value="{date}">
            </div>                
            <div class="form-group">
                <label>Article URL</label>
                <input type="text" id="article-url" name="url" value="{url}">
            </div>
            <div class="form-group">
                <label>Meta Title</label>
                <input type="text" id="meta-title" name="meta_title" value="{meta_title}">
            </div>
            <div class="form-group">
                <label>Meta Desc</label>
                <textarea id="meta-description" name="shortdesc" placeholder="meta-description">{shortdesc}</textarea>
            </div>

            <!-- Banner Preview Area -->
            <div class="banner-container">
                <div id="editable-banner" class="banner">
                    <!-- Background will be controlled by CSS -->
                    <div class="banner-content" id="banner-content">
                        <!-- HTML content will be inserted here -->

                        <div style="font-size: 48px;font-weight: bold;line-height: 1.2;margin-bottom: 20px;" id="thumbTitle">{title}
                        </div>
                    </div>

                    <!-- Image container -->
                    <div id="inner-image-container" class="inner-image-container">
                        <div class="inner-image">
                            <img id="banner-image" src="{firstVectorImage}" alt="Banner image">
                            <input type="hidden" id="article_id" value="{id}">
                            <!-- <input type="hidden" id="edit_param" value="{edit}"> -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label>Image</label>
                <div class="image-gallery">
                    <!-- <div class="image-option">
                    <img src="https://picsum.photos/id/1/150/150" alt="Image 1">
                </div> -->
                    {vectorImages}
                    <div class="image-option generate-more" onclick="generateMoreVector();">
                        <span id="generateMoreSpan">Generate More</span>
                    </div>
                </div>
            </div>

            <div class="editor-controls">
                <div class="editor-controls" style="margin-top: 0;">
                    <div class="form-group">
                        <label>Page / Image Title</label>
                        <input type="text" id="article-title" onkeyup="changeThumbTitle(this);" name="title" value="{title}">
                    </div>
                </div>
                <div class="form-group">
                    <label>Text</label>
                    <textarea class="ckeditor" cols="80" id="html-content" name="article" rows="10">{article}</div>
                </textarea>
            </div>

            <input type="submit" class="btn" name="delete" value="Delete" style="margin: 0;background: #fff;color: red;padding: 0;width: initial;font-weight: normal;{deleteBtnCss}" onclick="return confirm('Are you sure you want to delete this article?');">

            <div style="position: fixed;text-align:right;bottom:0;left:0;background: #f5f5f5;border-top:solid 1px #ddd;width:100%;padding:.5rem;z-index:999;">
                <input type="hidden" name="save" value="Save"><button id="set-thumb" class="btn" fdprocessedid="bvt9g7" style="margin: initial;display: inline-block;">Save &amp; Publish</button>
            </div>
        </div>
    </form>
    <script>

        CKEDITOR.on('instanceReady', function (ev) {
            ev.editor.fire('contentDom');
            // config.extraAllowedContent = '*(*)'; 
        });



        CKEDITOR.replace('html-content', {

            width: '768px',

            contentsCss: "body {font-size: 15px;font-family:'Poppins';letter-spacing: .4px;}"

        });





        CKEDITOR.addCss('p.imgcaption{background-color:#ccc;padding:5px;font-weight:600;font-size:15px;font-family: arial;}');

        CKEDITOR.extraAllowedContent = '*(*)';

        function generateMoreVector() {

            document.getElementById("generateMoreSpan").innerHTML = '<div class="loader"></div>';
            const xhr = new XMLHttpRequest();

            xhr.open("GET", "images.php?id={id}", true);

            xhr.onload = function () {
                if (xhr.status === 200) {
                    console.log("Response from PHP:", xhr.responseText);
                    if (xhr.responseText.includes('Done for ID')) {
                        alert('New images generated successfully!');
                        location.reload();
                    }
                } else {
                    console.error("Error:", xhr.statusText);
                }
                document.getElementById("generateMoreSpan").innerHTML = 'Generate More'; // Restore text
            };

            xhr.send();
        };

        function changeThumbTitle(elem){

            let val = elem.value;

            let thumbTitle = document.getElementById('thumbTitle').innerHTML = val;

        }
    </script>
    <!-- Scripts -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="./script.js"></script>

</body>

</html>