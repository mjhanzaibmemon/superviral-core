{
  "name": "superviral-lambda-build",
  "description": "CodeBuild project for Superviral Lambda functions",
  "source": {
    "type": "NO_SOURCE",
    "buildspec": "version: 0.2\n\nphases:\n\n  install:\n    commands:\n      - echo \"Installing Composer dependencies and Node.js packages...\"\n      - composer install --no-interaction --prefer-dist --optimize-autoloader --no-dev & npm install -g serverless@3 --cache /root/.npm && wait\n      - echo \"Checking AWS credentials...\"\n  pre_build:\n    commands:\n      - export BRANCH_NAME=$(echo ${CODEBUILD_WEBHOOK_HEAD_REF:-refs/heads/dev} | awk -F'/' '{print $NF}')\n  build:\n    commands:\n      - echo \"Fetching stage from AWS Parameter Store...\"\n      - STAGE=$(aws ssm get-parameter --name \"stage\" --query \"Parameter.Value\" --output text)\n      - echo \"Packaging and deploying with Serverless...\"\n      - serverless deploy --stage $BRANCH_NAME\n      - echo \"Deployment completed successfully.\"\n\nartifacts:\n  files:\n    - '**/*'\n\ncache:\n  paths:\n    - '/root/.cache/composer/**/*'\n    - '/root/.npm/**/*'\n    - './node_modules/**/*'\n    - './vendor/**/*'"
  },
  "artifacts": {
    "type": "NO_ARTIFACTS"
  },
  "environment": {
    "type": "LINUX_CONTAINER",
    "image": "aws/codebuild/standard:7.0",
    "computeType": "BUILD_GENERAL1_SMALL",
    "privilegedMode": false
  },
  "serviceRole": "ROLE_ARN_PLACEHOLDER"
}
